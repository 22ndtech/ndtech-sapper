'use strict';

import { config } from "@config/config"

const path = require('path');
const mongooseLib = require('mongoose');
const logger = config.logger;
let db = null;

export let mongoose = {

  // loadModel: function() {
  //   if (config.models) {

  //     // config.models.forEach(function(modelPath) {
  //     //   require(path.resolve(modelPath));
  //     // });
  //   }
  // },
  database: db,
  connect: function(cb) {
    logger.info("inside mongoose.connect***")

    console.log("config.dbPath = " + config.dbPath);

    console.log("config.dbOptions = " + JSON.stringify(config.dbOptions));
  
    db = mongooseLib.connect(config.dbPath, config.dbOptions, (err) => {
      if (err) {
        logger.error({}, 'Could not connect to MongoDB %s', err);
      } else {
        // this.loadModels();
        logger.info({}, 'Connected to MongoDB %s', config.dbPath);
        if (cb) {
          cb(db);
        }
      }
    });
  },
  disconnect: function(cb) {
    mongooseLib.disconnect((err) => {
      logger.info({}, 'Disconnect from MongoDB');
      cb(err);
    });
  }
}